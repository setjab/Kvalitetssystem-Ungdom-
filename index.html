<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Kvalitetssystem â€“ Ungdom</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; background:#f4f6f9; }
    header { 
      background:linear-gradient(90deg,#002d72,#004aad,#0066cc); 
      color:#fff; 
      padding:25px; 
      text-align:center; 
      font-size:28px; 
      font-weight:bold; 
      letter-spacing:1px;
      border-radius:10px;
      margin-bottom:20px;
    }
    .question { background:#fff; padding:12px; margin-bottom:10px; border-radius:6px; box-shadow:0 2px 5px rgba(0,0,0,.08); }
    .answer-btn { margin:5px; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; opacity:0.8; }
    .answer-btn.selected { outline:3px solid #000; opacity:1; }
    .answer-ja { background:#28a745; color:#fff; }
    .answer-nei { background:#dc3545; color:#fff; }
    .answer-usikker { background:#ffc107; color:#111; }
    .block-summary { margin-top:15px; padding:12px; background:#eef; border-radius:6px; }
    .export-btn { margin-top:15px; padding:10px 15px; background:#17a2b8; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    .save-btn { margin-top:10px; padding:10px 15px; background:#28a745; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    .status-circle { display:inline-block; width:56px; height:56px; border-radius:50%; margin-right:12px; vertical-align:middle; }
    .green { background:#28a745; }
    .red { background:#dc3545; }
    .yellow { background:#ffc107; }
  </style>
</head>
<body>

<header>Kvalitetssystem â€“ Ungdom (Utviklet av Settar Al-Jabri)</header>

<h2>Registrering</h2>
<input type="text" id="username" placeholder="Brukernavn / ID" style="width:80%; padding:8px;"/>
<div id="questions"></div>
<button onclick="saveData()" class="save-btn">ðŸ’¾ Lagre svar</button>

<hr/>

<div id="dashboard">
  <h2>Dashboard â€“ Samlet oversikt</h2>
  <canvas id="resultChart" width="500" height="250"></canvas>
  <div id="allSummary" class="block-summary"></div>
</div>

<button onclick="exportCSV()" class="export-btn">â¬‡ Last ned CSV</button>
<button onclick="exportPDF()" class="export-btn">ðŸ“„ Last ned PDF</button>

<script>
/* === SpÃ¸rsmÃ¥l (36 stk) === */
const questions = [
  // Del 1 (8)
  "Har du blitt tilstrekkelig kjent med personen for Ã¥ forstÃ¥ behovet for oppfÃ¸lging fremover?",
  "Hvis brukeren har oppgitt hindringer eller behov for hjelp og veiledning, har du hatt en samtale?",
  "Har samtalen handlet om brukerens jobbmuligheter?",
  "Hvordan er kvaliteten i oppfÃ¸lgingsvedtaket?",
  "â€” Inneholder begrunnelsen vurdering av brukerens Ã¸nsker, ressurser og forutsetninger?",
  "â€” Inneholder begrunnelsen vurdering av personens jobbmuligheter (nÃ¥ eller pÃ¥ sikt)?",
  "â€” Inneholder begrunnelsen vurdering av personens muligheter opp mot bransjer og/eller yrker?",
  "â€” Inneholder begrunnelsen vurdering av hvilken hjelp og stÃ¸tte som trengs?",
  // Del 2 (15)
  "Er det en tydelig arbeidsretting i samhandlingen med brukeren?",
  "â€” Har personen fÃ¥tt veiledning knyttet til jobbmÃ¥l?",
  "â€” Har arbeid og aktivitet vÃ¦rt sentrale tema i dialogen?",
  "â€” Har brukeren arbeidsrettede aktiviteter i planen sin?",
  "â€” Har det vÃ¦rt tydelige avtalte oppfÃ¸lgingspunkter?",
  "Har du vurdert hvilken hjelp og stÃ¸tte som kan bidra til jobb?",
  "â€” Har du vurdert tilrettelegging pÃ¥ arbeidsplassen?",
  "â€” Har du vurdert kvalifisering/opplÃ¦ring?",
  "â€” Har du vurdert samarbeid med andre enheter?",
  "Har det vÃ¦rt samhandling med arbeidsgiver(e)?",
  "â€” Er arbeidsgiver en del av oppfÃ¸lgingen?",
  "â€” Har du vurdert lÃ¸nnstilskudd/mentor?",
  "Har oppfÃ¸lgingen blitt evaluert underveis?",
  "â€” Har aktivitetene blitt evaluert sammen med brukeren?",
  "â€” Har mÃ¥l/situasjon endret seg og nytt vedtak blitt fattet?",
  // Del 3 (10)
  "Har brukermÃ¸tene vÃ¦rt planlagte?",
  "â€” Er mÃ¸teagenda delt med brukeren?",
  "â€” Brukes aktivitetsplanen i oppfÃ¸lgingen?",
  "â€” Har du vurdert digital oppfÃ¸lging?",
  "â€” Inneholder referater tydelige avtaler?",
  "Har brukeren fÃ¥tt medvirke i samarbeidet?",
  "â€” Blir Ã¸nsker og behov ivaretatt?",
  "â€” Har brukeren fÃ¥tt informasjon om mÃ¥let?",
  "â€” Er det gjennomfÃ¸rt fysiske mÃ¸ter?",
  "â€” Har brukeren medvirket i valg av tiltak?",
  // Del 4 (3)
  "Har den unge fÃ¥tt informasjon om ungdomsgarantien?",
  "Har den unge hatt brudd i oppfÃ¸lgingen?",
  "Er det jobbet med Ã¥ gi den unge mÃ¥lrettede aktiviteter?"
];

/* === Blokker === */
const blocks = {
  "Bli kjent og forstÃ¥ behov": Array.from({length:8},(_,i)=>i),
  "Arbeidsretting og fremdrift": Array.from({length:15},(_,i)=>i+8),
  "Brukermedvirkning": Array.from({length:10},(_,i)=>i+23),
  "Ungdomsgaranti (U30)": Array.from({length:3},(_,i)=>i+33)
};

let allAnswers = [];
let resultChart = null;
let answers=[];

/* Render spÃ¸rsmÃ¥l */
function renderQuestions(){
  const qDiv=document.getElementById("questions");
  qDiv.innerHTML="";
  questions.forEach((q,i)=>{
    qDiv.innerHTML+=`
      <div class="question" id="q${i}">
        <strong>${i+1}. ${q}</strong><br>
        <button class="answer-btn answer-ja" onclick="setAnswer(${i},'Ja',this)">Ja</button>
        <button class="answer-btn answer-nei" onclick="setAnswer(${i},'Nei',this)">Nei</button>
        <button class="answer-btn answer-usikker" onclick="setAnswer(${i},'Usikker',this)">Usikker</button>
      </div>`;
  });
}
function setAnswer(i,val,btn){
  answers[i]=val;
  document.querySelectorAll(`#q${i} .answer-btn`).forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
}

/* Lagre */
function saveData(){
  const username=document.getElementById("username").value||"Ukjent";
  const userAnswers=questions.map((q,i)=>({question:q,answer:answers[i]||""}));
  allAnswers.push({user:username,answers:userAnswers});
  renderChartAndBlocks();
  document.getElementById("username").value="";
  answers=[];
  renderQuestions();
}

/* Graf + blokker (samlet for alle brukere) */
function renderChartAndBlocks(){
  const counts={Ja:0,Nei:0,Usikker:0};
  allAnswers.forEach(u=>{
    u.answers.forEach(a=>{ if(a.answer) counts[a.answer]++; });
  });
  const ctx=document.getElementById("resultChart").getContext("2d");
  if(resultChart) resultChart.destroy();
  resultChart=new Chart(ctx,{
    type:'bar',
    data:{labels:["Ja","Nei","Usikker"],datasets:[{data:[counts.Ja,counts.Nei,counts.Usikker],backgroundColor:["#28a745","#dc3545","#ffc107"]}]},
    options:{responsive:false,plugins:{legend:{display:false}}}
  });

  let html="<h4>Oppsummering per blokk (alle brukere)</h4>";
  for(const [block,idxs] of Object.entries(blocks)){
    let ja=0,nei=0,usikker=0;
    allAnswers.forEach(u=>{
      idxs.forEach(i=>{
        if(u.answers[i].answer==="Ja") ja++;
        if(u.answers[i].answer==="Nei") nei++;
        if(u.answers[i].answer==="Usikker") usikker++;
      });
    });
    let total=ja+nei+usikker;
    let statusClass="yellow";
    if(ja>nei && ja>usikker) statusClass="green";
    else if(nei>ja && nei>=usikker) statusClass="red";

    html+=`
      <p><span class="status-circle ${statusClass}"></span>
      <b>${block}:</b> Totalt: ${total} (Ja:${ja}, Nei:${nei}, Usikker:${usikker})</p>`;
  }
  document.getElementById("allSummary").innerHTML=html;
}

/* Eksport CSV */
function exportCSV(){
  let csv="Bruker,SpÃ¸rsmÃ¥l,Svar\n";
  allAnswers.forEach(u=>{
    u.answers.forEach(a=>{
      csv+=`${u.user},"${a.question}",${a.answer}\n`;
    });
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="resultater.csv";
  link.click();
}

/* Eksport PDF â€“ 3x stÃ¸rre + 2 cm margin */
async function exportPDF(){
  const { jsPDF }=window.jspdf;
  const element=document.getElementById("dashboard");
  const canvas=await html2canvas(element,{scale:3});
  const imgData=canvas.toDataURL("image/png");
  const pdf=new jsPDF("p","mm","a4");
  const pdfWidth=pdf.internal.pageSize.getWidth()-20; // 2 cm margin
  const pdfHeight=(canvas.height*pdfWidth)/canvas.width;
  pdf.addImage(imgData,"PNG",20,10,pdfWidth,pdfHeight); // flyttet 20mm til hÃ¸yre
  pdf.save("resultater.pdf");
}

renderQuestions();
</script>
</body>
</html>
